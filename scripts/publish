#!/bin/sh -e

for package_dir in plain*; do
    cd "$package_dir"
    rm -rf dist
    uv build

    # Run uv publish and capture exit code while displaying output in real-time
    if ! uv publish --no-progress 2>&1 | tee /dev/stderr | grep -q "already exists"; then
        echo "Publish failed with an unexpected error."
        exit 1
    fi

    cd ..
done
